# Веб-Сервер
В данном задании с помощью Flask и gevent.pywsgi.WSGIServer был реализован веб-сервер.

- для запуска  сервера нужно выполнить `python3 rest_server.py`
- для запуска клиента нужно выполнить `python3 cli.py`

## Необходимо для работы
Полный список всех необходимых для работы :
1. Для Ubuntu: python3.6 python3-pip, git, net-tools.
2. Для Python3: decorator (=4.4.0), flask (=1.0.3), flask-httpauth (=3.2.4), gevent (=1.4.0), requests (=2.22.0).

## Описание сервера
Сервер соответствующий архитектуре REST.,В зависимоти от входных параметров сервер будет запускать либо тестовый flask сервер, либо WSGI сервер.Также имеется ограничение на размер принимаемых данных в теле запроса равное 16 Мб.Поддерживает https с сертификатами от openssl.Любой обмен данными с клиентами осуществляется с помощью json.

Сервер имеет базовую http-авторизацию. Т.е. для получения доступа к серверу надо в каждом запросе добавить заголовок, содержащий логин:пароль, закодированный с помощью `base64` (логин: `test_serv`, пароль: `task_4`). 

Все действия на всех уровнях заносятся в log (формат логов: уровень | адрес_клиента, сообщение), log пишется в файл `server.log` и дублируется в терминале.
```
INFO     | 2019-07-18 12:38:05,533 -  WSGI сервер запущен на http://192.168.2.58:5000 (нажмите Ctrl+C или Ctrl+Z для выхода)
INFO     | 2019-07-18 12:38:19,985 - 192.168.2.58 - - [2019-07-18 12:38:19] "GET / HTTP/1.1" 200 126 0.001202
INFO     | 2019-07-18 12:38:19,988 - -addr - 192.168.2.58   принято: 'iter  1'
INFO     | 2019-07-18 12:38:19,990 - 192.168.2.58 - - [2019-07-18 12:38:19] "POST /post/ HTTP/1.1" 200 122 0.002014
INFO     | 2019-07-18 12:38:19,992 - -addr - 192.168.2.58   принято: 'iter  2'
INFO     | 2019-07-18 12:38:19,994 - 192.168.2.58 - - [2019-07-18 12:38:19] "POST /post/ HTTP/1.1" 200 122 0.002015
INFO     | 2019-07-18 12:38:19,997 - -addr - 192.168.2.58   принято: 'iter  3'
INFO     | 2019-07-18 12:38:19,998 - 192.168.2.58 - - [2019-07-18 12:38:19] "POST /post/ HTTP/1.1" 200 122 0.001729
```
Ззначения host:port по умолчанию 127.0.0.1:5000.Также есть возможность задавать аргументы с помощью командной строки,котораые имеют следующую структуру: [ключ] [адрес:порт]
- возможные ключи:
  - `-d` - запуск тестового Flask сервера 
  - `-s` - запуск сервера с поддержкой https
- допустимые варианты адрес:порт:
  - `host:port` - запуск на указанном host и port
  - `localaddr:port` - запуск с автоопределением адреса машины в локальной сети и указанным port
  - `host:0` или `localaddr:0` - если port = 0, то будет выбран любой доступный порт автоматически
- список возможных комбинаций аргументов командной строки и их описание:
  - `без аргументов` - запуск WSGI сервера с автоопределением адреса машины в локальной сети и портом 5000. Пример выполнения: `python3 rest_server.py`
  - `host:port` - запуск WSGI сервера на указанном host и port. Пример выполнения: `python3 rest_server.py 192.168.2.102:5000`
  - `-d` - запуск тестового Flask сервера на 127.0.0.1:5000. Пример выполнения: `python3 rest_server.py -d`
  - `-d host:port` - запуск тестового Flask сервера на указанном host и port. Пример выполнения: `python3 rest_server.py -d 192.168.2.102:5000`
  - `-d localaddr:port` - запуск тестового Flask сервера с автоопределением адреса машины в локальной сети и портом port. Пример выполнения: `python3 rest_server.py -d localaddr:5000`
  - `-s` - запуск WSGI сервера с поддержкой https, автоопределением адреса машины в локальной сети и портом 5000. Пример выполнения: `python3 rest_server.py -s`
  - `-s host:port` - запуск WSGI сервера с поддержкой https на указанном host и port. Пример выполнения: `python3 rest_server.py -s 192.168.2.102:5000`
  - `-s -d` - запуск тестового Flask сервера с поддержкой https на 127.0.0.1:5000. Пример выполнения: `python3 rest_server.py -s -d`
  - `-s -d host:port` - запуск тестового Flask сервера с поддержкой https на указанном host и port. Пример выполнения: `python3 rest_server.py -s -d 192.168.2.102:5000`
  - `-s -d localaddr:port` - запуск тестового Flask сервера с поддержкой https, автоопределением адреса машины в локальной сети и портом port. Пример выполнения: `python3 rest_server.py -s -d localaddr:5000`

## Описание клиента
Клиент отправляет запросы с помощью библиотеки requests и ждет отклика серверва.
Клиент получает информация про наш веб-сервер, а далее отсылает 10 сообщений с текстом `iter  n`, чтобы перейти на следующую итерацию n+1, клиент должен дождаться отклика сервера, n - номер итерации.

Есть возможность автоопределение адреса компа в локальной сети.

Значения host:port по умолчанию 127.0.0.1:5000.Также есть возможность задавать аргументы с помощью командной строки,котораые имеют следующую структуру: [host:port]
- список возможных комбинаций аргументов командной строки и их описание:
  - `без аргументов` - запуск с автоопределением адреса машины в локальной сети и портом 5000. Пример выполнения: `python3 rest_client.py`
  - `host:port` - запуск с подключением к указанному host и port. Пример выполнения : `python3 rest_client.py 192.168.2.102:5000`

## Docker-образ 

В проекте содержится Dockerfile, который позволяет собрать docker образ на основе данного проекта.

Для сборки образа необходимо перейти в терминале в папку с проектом и выполнить (`-t` — запуск терминала, `.` — директория, из которой вызывается docker build (точка — значит в текущей директории находятся все файлы для образа), `z4:0.1` — метка образа и его версия):
```
sudo docker build -t z4:0.1 .
```

После успешного выполнения данной операции вы можете вывести список имеющихся образов, выполнив:
```
sudo docker images
```
В полученном списке вы увидите наш образ — `z4:0.1`.

Теперь вы можете запустить этот образ (`-t` — запуск терминала, `-i` — интерактивный режим, `--rm` — удалить контейнер после завершения его работы, `-p 5000:5000` — пробросить все подключения на порт 5000 к машине-хосту в контейнер на порт 5000 (вы так же можете явно указать другой адрес, к которому нужно будет подключиться извне, например: `-p 127.0.0.1:5000:5000`)):
```
sudo docker run -ti -p 5000:5000 --rm z4:0.1
```

В результате WSGI сервер запустится на `172.17.0.2:5000:5000` и можно к нему обращаться по указанному в терминале адресу (если вы не указали другой при запуске образа).

Собранный docker-образ весит 581 Mб.

